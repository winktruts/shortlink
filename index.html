<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RaiMovie - Watch Free Movies</title>
  <style>
    /* [CSS tetap sama seperti sebelumnya] */
  </style>
</head>
<body>
  <script type='text/javascript' src='//pl26895411.profitableratecpm.com/34/9b/9c/349b9cffc26c2533d86070e4f7690c55.js'></script>
  <header>
    <h1>RaiMovie</h1>
    <p>Watch the latest movies without ads or hassle</p>
  </header>

  <div class="genres">
    <button onclick="filterByGenre(28)">Action</button>
    <button onclick="filterByGenre(35)">Comedy</button>
    <button onclick="filterByGenre(18)">Drama</button>
    <button onclick="filterByGenre(27)">Horror</button>
    <button onclick="filterByGenre(16)">Animation</button>
  </div>

  <section class="hero">
    <h2>Free Streaming of Box Office Movies!</h2>
  </section>

  <section class="section">
    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search for your favorite movie...">
    </div>
    <h2 style="text-align:center; margin-bottom: 20px;">Today's Recommendations</h2>
    <div class="movies"></div>
  </section>

  <div class="modal" id="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">&times;</span>
      <h2 id="modalTitle"></h2>
      <p id="modalOverview"></p>
      <p><strong>Rating:</strong> <span id="modalRating"></span></p>
      <p><strong>Genres:</strong> <span id="modalGenres"></span></p>
    </div>
  </div>

  <footer>
    &copy; 2025 RaiMovie. All Rights Reserved.
  </footer>

  <script>
    const container = document.querySelector('.movies');
    const searchInput = document.getElementById('searchInput');

    async function fetchMovies(query = '', genre = '') {
      const url = `/api/movies${query ? `?query=${encodeURIComponent(query)}` : genre ? `?genre=${genre}` : ''}`;
      const res = await fetch(url);
      const data = await res.json();
      container.innerHTML = '';

      const movies = data.results.slice(0, 12);
      for (const movie of movies) {
        const trailerUrl = await fetch(`/api/trailer?id=${movie.id}`).then(r => r.text());
        const movieEl = document.createElement('div');
        movieEl.className = 'movie';
        movieEl.innerHTML = `
          <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" alt="${movie.title}">
          <h3>${movie.title}</h3>
          <div class="buttons">
            <a href="https://www.profitableratecpm.com/hk68cccn2?key=3afd55eed6781c064cb17069870e7f22" class="btn">ðŸŽ¬ Watch</a>
            <a href="#" class="btn btn-alt">ðŸ“¥ Download</a>
            ${trailerUrl ? `<a href="${trailerUrl}" target="_blank" class="btn btn-trailer">â–¶ Trailer</a>` : ''}
          </div>
        `;
        movieEl.addEventListener('click', () => showDetails(movie.id));
        container.appendChild(movieEl);
      }
    }

    async function showDetails(movieId) {
      const res = await fetch(`/api/details?id=${movieId}`);
      const data = await res.json();
      document.getElementById('modalTitle').innerText = data.title;
      document.getElementById('modalOverview').innerText = data.overview;
      document.getElementById('modalRating').innerText = data.vote_average;
      document.getElementById('modalGenres').innerText = data.genres.map(g => g.name).join(', ');
      document.getElementById('modal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('modal').style.display = 'none';
    }

    function filterByGenre(id) {
      fetchMovies('', id);
    }

    async function setDynamicBackground() {
      try {
        console.log('Fetching dynamic background...');
        const res = await fetch('/api/movies');
        const data = await res.json();
        const latest = data.results[0];
        console.log('Result:', latest);

        if (latest && latest.backdrop_path) {
          document.body.style.background = `
            linear-gradient(to bottom, rgba(0,0,0,0.85), rgba(0,0,0,0.95)),
            url('https://image.tmdb.org/t/p/original${latest.backdrop_path}') no-repeat center center fixed
          `;
          document.body.style.backgroundSize = 'cover';

          const header = document.querySelector('header');
          header.style.backgroundImage = `url('https://image.tmdb.org/t/p/original${latest.backdrop_path}')`;
          header.style.backgroundSize = 'cover';
          header.style.backgroundPosition = 'center';
        }
      } catch (err) {
        console.error('Failed to fetch dynamic background:', err);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      fetchMovies();
      setDynamicBackground();
    });
  </script>
</body>
</html>
